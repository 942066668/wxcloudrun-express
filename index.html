<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var district_id = "440307";//行政区划编码  深圳龙岗
    var ak = "O1twdsEvE84gBYrGGqVSxx3UVwxxtsxl";//百度应用的ak
    var caihongpiKey = "ef7065348243005fbfed4fb4555039de";//天行数据key


    /*微信参数*/
    var appId = "wx436b3ec2315afb9b";//开发者ID
    var secret = "c7820935a6de9b7bc8169d00f8296d4a";//开发者密码
    //var appId = "wx12c7cf48673497ea";//开发者ID
    //var secret = "929f10edb41a39272667f5d4b33959b4";//开发者密码
    var openId = "ofVn15tsXLA969P-jbO1XZp2jG5w";//微信号
    var templateId = "uN-fWYr5GZ0hmiaMzFQ1LZ8xKOw2MpDMLsbbs1rNziE-bAdTN5I";//模板ID

    var beizhu = "";//自定义备注
    //var lianAi = DateUtil.convertStringToDate("2021-12-11", DateUtil.PATTERN_DATE);
    //var shengRi = DateUtil.convertStringToDate("1993-10-07", DateUtil.PATTERN_DATE);

    window.weather = "";
    function getWeather(){
        window.weather = "";
        $.get("https://api.map.baidu.com/weather/v1/?district_id=" + district_id + "&data_type=all&ak=" + ak,function(data){
            console.log(data);
            if (data["message"] == "success") {
                window.weather = data["result"]["forecasts"][0];
            }
        });
    }

    /**
     * 获取微信token
     * @return
     */
    window.access_token = "";
    function getWXToken() {
        window.access_token = "";
        $.get("https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid="+appId+"&secret="+secret,function(data){
            console.log(data);
            window.access_token = data["access_token"];
        });
    }

    /**
     * 发送微信通知
     * @return
     */
    function send() {
        var todayWeather = window.weather;
        var paramMap = {"touser":openId, "template_id":templateId, "topcolor":"#FF0000"};
        var dataMap = {};
        dataMap["date"] = {"value":todayWeather["date"] + "  "+ todayWeather["week"], "color":"#00BFFF"};
        dataMap["weather"] = {"value":todayWeather["text_day"], "color":"#00BFFF"};
        dataMap["low"] = {"value":todayWeather["low"], "color":"#173177"};
        dataMap["high"] = {"value":todayWeather["high"], "color":"#FF6347"};
        //dataMap["rainbow"] = {"value":getCaiHongPi(), "color":"#FF69B4"};
        //dataMap["jinju"] = {"value":getCaiHongPi(), "color":"#660099"};
        //dataMap["birthday"] = {"value":"2020-01-01", "color":"#FFA500"};
        //dataMap["love"] = {"value":"2020-01-01", "color":"#FF1493"};


        var remarks = "又是充满希望的一天~";
        if("星期一".equals(week)) {
            remarks = "美好的一周开始啦~宝贝冲鸭！";
        }else if("星期二".equals(week)) {
            remarks = "宝贝星期二也要元气满满鸭！";
        }else if("星期五".equals(week)) {
            remarks = "宝贝加油！马上周末啦~";
        }

        if(beizhu != "")remarks = beizhu;

        if(love % 365 == 0){
            remarks = "今天是恋爱纪念日！";
        }
        if(birthday == 0){
            remarks = "今天是宝贝的生日！";
        }
        dataMap["remarks"] = {"value":remarks, "color":"#FFA500"};
        paramMap["data"] = dataMap;//内容

        $.post("https://api.weixin.qq.com/cgi-bin/message/template/send?access_token="+window.access_token, $.param(paramMap), function(data){
            console.log("发送微信通知："+data);
            if (data["errcode"] && data["errcode"] == 0) {
                console.log("发送成功！");
            }
        });


       /* paramMap.put("touser", "ofVn15tsXLA969P-jbO1XZp2jG5w");//自己的微信号
        result = $.post("https://api.weixin.qq.com/cgi-bin/message/template/send?access_token="+WXToken, JSONObject.fromObject(paramMap).toString());
        System.out.println("发送微信通知："+result);
        console.log("发送微信通知："+result);
        if (jsonObject["errcode"] && jsonObject["errcode"] == 0) {
            console.log("发送成功！");
        }*/
    }

    window.onload = function() {
        getWeather();
        getWXToken();
        setTimeout(function(){
            if(window.access_token == "") {
                console.log("获取微信token失败");
                return;
            }
            if(window.weather == "") {
                console.log("获取微信token失败");
                return;
            }
            send();
        }, 1000);
    }
</script>
</html>
